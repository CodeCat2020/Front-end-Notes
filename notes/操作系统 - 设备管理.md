

# 一、 概述

\1.    设备类型

1)    按操作特性分类：

l 存储设备：磁带机、硬盘、光盘

l 输入/输出设备：键盘、扫描仪、打印机

2)    按设备的隶属关系分类

l 系统设备：计算机中最基本的标准配置设备，常常在操作系统启动时自动完成设备的登录。

l 用户设备：可由用户根据实际需要连入系统，在使用之前通过运行对应的驱动程序进行安装、登录。

3)    按信息组织方式分类

l 字块设备（存储型设备）

l 字符设备（输入/输出型设备）

4)    按资源分配角度分类

l 独占设备

l 共享设备

l 虚拟设备

\2.    设备管理的任务

1)    选择和分配IO设备以进行数据传输操作

2)    控制IO设备和内存之间交换数据

3)    为用户提供友好的透明接口：使得用户在编程时不必涉及设备的硬件特性，由系统按照用户要求控制设备工作

4)    提高并行操作度：设备和设备之间、CPU和设备之间，以及进程和进程之间

\3.    设备管理的功能

1)    提供和进程管理系统的接口：将进程的设备资源要求转达给设备管理程序

2)    进行设备分配：按照设备类型和分配算法把设备及相关硬件分配给请求该设备的进程，并把未得到分配的进程放入等待队列

3)    实现设备和设备、设备和CPU等之间的并行操作：对于不同的I/O控制方式，需要有相应的硬件支持，如控制器、通道或DMA等

4)    进行缓冲区的分配、释放及相关的管理：为了减少外部设备和内存与CPU之间的数据速度不匹配的问题，系统设置缓冲区来暂放数据

 

 

# 二、 数据传送控制方式

\4.    程序直接控制方式

\5.    中断控制方式

\6.    DMA方式（Direct Memory Access直接存取方式）

\7.    通道方式

 

 

# 三、 中断技术

\8.    中断的基本概念

1)    中断(Interrupt)：指计算机在执行期间，系统内发生非寻常的或非预期的急需处理事件，使得CPU暂时中断当前正在执行的程序而转去执行相应的事件处理程序。待处理完毕后又返回原来中断处继续执行或调度新的程序执行的过程。

2)    中断源：引起中断的事件及发生中断请求的来源

3)    中断请求：中断源向CPU发出的请求中断处理信号。

4)    中断响应：CPU收到中断请求后转相应的事件处理程序。

5)    禁止中断（关中断）：CPU内部的处理机状态字PSW的中断允许位已被清除，不允许CPU响应中断。

6)    开中断：PSW的中断允许位的设置。

7)    中断屏蔽：在中断请求产生之后，系统用软件方式有选择地封锁部分中断而允许其余部分的中断仍能得到响应。

\9.    中断的分类与优先级

1)    根据中断源产生的条件

a)    外中断：指来自处理机和内存外部的中断，由CPU执行指令以外的事件引起，包括I/O中断、外部信号中断、时钟中断、调试中断、控制台中断等。外中断在狭义上一般被称为中断。I/O 完成中断，表示设备输入/输出处理已经完成，处理器能够发送下一个输入/输出请求。

b)    内中断：指在处理机和内存内部产生的中断，一般称为 (trap)或异常。

l 陷进（陷入）：在用户程序中使用系统调用。

l 异常：由CPU执行指令的内部事件引起，如非法操作码、地址越界、算术溢出等。

2)    强迫中断和自愿中断

3)    可屏蔽中断和不可屏蔽中断

4)    向量中断和非向量中断

 

\10.  中断和陷阱的主要区别：

1)    陷阱通常由处理机正在执行的现行指令引起，而中断则是由与现行指令无关的中断源引起的。

2)    陷阱处理程序提供的服务为当前进程所用，而中断处理程序提供的服务则不是为了当前进程的。

3)    CPU在执行完一条指令之后，下一条指令开始之前响应中断，而在一条指令执行中也可以响应陷阱。

4)    有的系统中，陷进处理程序被规定在各自的进程上下文中执行，而中断处理程序则在系统上下文中执行。

\11.  软中断

5)    硬中断：中断和陷阱要通过硬件产生相应的中断请求

6)    软中断：通信进程之间用来模拟硬中断的一种信号通信方式。

7)    软中断与硬中断的比较：

l 相同点：中断源发中断请求/软中断信号后，CPU/接收进程在适当的时机自动进行中断处理/完成软中断信号所对应的功能。

l 不同点：接收软中断信号的进程不一定正好在接收时占有处理机，相应的处理必须等到该接收进程得到处理机之后才能进行。

\12.  中断的处理过程

 

# 四、 缓冲技术

\13.  缓冲的引入

1)    缓和CPU和I/O设备间速度不匹配的矛盾

凡在数据的到达速率与离去速率不同的地方，都可设置缓冲，以缓和速度不匹配的矛盾。

2)    减少对CPU的中断次数：等到缓冲区满时才产生中断

3)    提高CPU和I/O设备之间的并行性

\14.  缓冲的种类

根据系统设置的缓冲器的个数，缓冲技术分为：

8)    单缓冲

9)    双缓冲

10)  多缓冲

11)  缓冲池

\15.  缓冲池的管理

12)  缓冲池有四种工作缓冲区：

l 用于收容输入数据的工作缓冲区（hin）：输入设备--> 缓冲区

l 用于提取输入数据的工作缓冲区（sin）：缓冲区-->CPU

l 用于收容输出数据的工作缓冲区（hout）：CPU--> 缓冲区

l 用于提取输出数据的工作缓冲区（sout）：缓冲区-->输出设备

13)  缓冲池的工作方式

缓冲区在收容输入、提取输入、收容输出和提取输出四种方式下工作。

14)  缓冲池的工作原理：

 

# 五、 设备分配技术

\16.  设备分配中的数据结构

1)    系统设备表SDT

2)    设备控制表DCT

3)    控制器控制表COCT

4)    通道控制表CHCT

\17.  设备分配的方式

15)  静态分配

16)  动态分配

\18.  设备的独立性（设备无关性）

\19.  设备分配策略

17)  先来先服务

18)  优先级高者优先

\20.  设备分配步骤

\21.  虚拟设备的分配和假脱机系统

19)  虚拟设备

虚拟设备不是真正意义上的物理设备，它是指代替独享设备的那部分存储空间及有关的控制结构。

对虚拟设备采用的是虚拟分配，其过程是：

当进程请求独享设备时，系统将共享设备的一部分存储空间分配给它。进程与设备交换信息时，系统把要交换的信息存放在这部分存储空间，在适当的时候对信息作相应的处理。

20)  假脱机技术：SPOOLING系统(Simultaneous Peripheral Operation On Line)

物理设备->可共享的虚拟设备

假脱机又称为Spooling，是用来保存设备输出的缓冲区，这些设备不能接受交叉的数据流。例如打印机虽然只能一次打印一个任务，但是可能有多个程序希望希望并发打印而又不能将其输出混在一起。应用程序的输出先是假脱机到一个独立的磁盘上。当应用程序完成打印时，假脱机系统将响应的待送打印机的假脱机文件进行排队。

a)    也称，同时联机的外围操作或假脱机操作

b)    思想：利用一台高速共享设备（磁盘或磁鼓）将一台独占设备模拟成多台可并行操作的虚拟设备。这样一来，使每个用户都感到得到了系统中的一台独享设备。

这种技术产生在计算机技术发展到一定阶段，在硬件中出现了大容量的共享设备：磁盘，通道和中断技术，在软件中出现了多道程序技术的前提下。

21)  SPOOLING系统的组成：

a)    硬件部分：输入井和输出井，输入缓冲区和输出缓冲区

l 输入井：用来存放来自于输入设备的信息。

l 输出井：用来保存即将送到输出设备上的结果。

l 输入缓冲区：暂时保存外设准备送入输入井的信息。

l 输出缓冲区：暂时保存从输出井送出的结果。

b)    软件部分：预输入进程、缓输出进程、输入井管理进程、输出井管理进程

l 预输入进程：将用户要求的输入到设备上的输入数据，经通道和输入缓冲区送入输入井

l 缓输出进程：将用户的输出结果在设备空闲时从输出井中，经输出缓冲区送上输出设备

l 输入井管理进程：将输入井中的数读入内存

l 输出井管理进程：将内存中的结果送输出井中

22)  假脱机系统的特点：

l 提高了I/O 速度 。从对低速I/O 设备进行的I/O操作变为对输入井或输出井的操作，缓和了CPU 与低速I/O设备速度不匹配的矛盾。

l 设备并没有分配给任何进程 。将独占型设备改造为共享设备；在输入井或输出井中，分配给进程的是一存储区和建立一张I/O请求表。

l 实现了虚拟设备功能 。多个进程同时使用一独享设备，而对每一进程而言，都认为自己独占这一设备，不过，该设备是逻辑上的设备。

 

# 六、 I/O进程控制

\22.  I/O控制的引入

\23.  I/O控制的功能

\24.  I/O控制的实现方式

 

I/O操作是输入/输出设备与主机之间的数据传输过程

I/O操作与CPU的数据处理往往是并行工作

I/O设备种类繁多，性能差异大，但它们能并行工作

 

程序IO方式，是采用busy-waiting的方式，即CPU会采用轮询的方式来询问数据-------效果最差

 

 

中断IO方式，是设备控制器当取出一个数据之后向CPU发送一个中断，然后CPU将数据从控制器中取到CPU寄存器，再然后转移到内存中。这种方式，CPU是以字节的方式来响应数据的。

 

 

DMA方式，是CPU通过向DMA控制器设定若干参数，然后DMA打开了一条内存到设备的通道，这样，设备（内存）中的数据可以不通过ＣＰＵl来进行数据交互。缺点是，DMA是多少设备就需要多少DMA，而且，DMA方式下，CPU的访问设备是以数据块为周期的。

 

到了IO通道方式，IO通道相当于一个简单的处理机，有自己的指令，也可以执行指令。指令存储在内存。

 

IO通道相当于一条PCI总线，一条IO通道可以连接所有的设备控制器。然后CPU向IO通道发出指令，IO通道将会自动进行获取数据。

 

另外，IO通道是以一组块为单位进行获取的。

 

# 七、 设备驱动程序

















